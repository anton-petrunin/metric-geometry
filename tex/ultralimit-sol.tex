%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\refstepcounter{chapter}
\setcounter{eqtn}{0}

\parbf{\ref{ex:ultrakatetov}.} 
Let $F=\set{n\in \NN}{f(n)=n}$; we need to show that $\omega(F)=1$.

Consider an oriented graph $\Gamma$ with vertex set $\NN\setminus F$ such that $m$ is connected to $n$ if $f(m)=n$.
Show that each connected component of $\Gamma$ has at most one cycle.
Use it to subdivide vertices of $\Gamma$ into three sets $S_1$, $S_2$, and $S_3$ such that $f(S_i)\cap S_i=\emptyset$ for each $i$.

Conclude that $\omega(S_1)=\omega(S_2)=\omega(S_3)=0$ and hence \[\omega(F)=\omega(\NN\setminus(S_1\cup S_2\cup S_3))=1.\]

\parit{Source:} 
The presented proof was given by Robert Solovay \cite{solovay}, but
the key statement is due to Miroslav KatÄ›tov \cite{katetov}.

\parbf{\ref{ex:linear}.}
Choose a nonprincipal ultrafilter $\omega$ and set $L(\bm{s})=s_\omega$.
It remains to observe that $L$ is linear.

\parit{Remark.} 
This construction identifies ultrafilters with vectors in $(\ell^\infty)^*$.
Recall that $\ell^\infty=(\ell^1)^*$ and $\ell^1\subsetneq(\ell^\infty)^*$.
A principle ultrafilter is a basis vector in $\ell^1$; 
nonprincipal ultrafilters lie in $(\ell^\infty)^*\setminus\ell^1$.
The set of ultrafilters is the closure of basis vectors in $\ell^1$ with respect to weak*-topology on $(\ell^\infty)^*$.


\parbf{\ref{ex:ultrakatetov+}.}
Apply \ref{ex:ultrakatetov}.

\parbf{\ref{ex:lim(tree)}.}
Let $\gamma$ be a path from $p$ to $q$ in a metric tree $\spc{T}$.
Assume that $\gamma$ passes thru a point $x$ on distance $\ell$ from $[pq]$.
Then 
\[\length\gamma\ge \dist{p}{q}{}+2\cdot \ell.
\eqlbl{eq:+ell}\]

Suppose that $\spc{T}_n$ is a sequence of metric trees that $\omega$-converges to $\spc{T}_\omega$.
By \ref{obs:ultralimit-is-geodesic}, the space $\spc{T}_\omega$ is geodesic.

The uniqueness of geodesics follows from \ref{eq:+ell}.
Indeed, if for a geodesic $[p_\omega q_\omega]$ there is another geodesic $\gamma_\omega$ connecting its ends, then it has to pass thru a point $x_\omega\notin [p_\omega q_\omega]$.
Choose sequences $p_n,q_n,x_n\in\spc{T}_n$ such that $p_n\to p_\omega$, $q_n\to q_\omega$, and $x_n\to x_\omega$ as $n\to\omega$.
Then 
\begin{align*}
\dist{p_\omega}{q_\omega}{}&=\length\gamma\ge 
\\
&\ge\lim_{n\to\omega}(\dist{p_n}{x_n}{}+\dist{q_n}{x_n}{})\ge
\\
&\ge \lim_{n\to\omega}(\dist{p_n}{q_n}{}+2\cdot\ell_n)=
\\
&=\dist{p_\omega}{q_\omega}{}+2\cdot\ell_\omega.
\end{align*}
Since $x_\omega\notin [p_\omega q_\omega]$, we have that $\ell_\omega>0$ --- a contradiction.

It remains to show that any geodesic triangle $\spc{T}_\omega$ is a tripod.
Consider the sequence of centers of tripods $m_n$ for given sequences of points $x_n,y_n,z_n\in \spc{T}_n$.
Observe that its ultralimit $m_\omega$ is the center of a tripod with ends at $x_\omega,y_\omega,z_\omega\in \spc{T}_\omega$.

\parbf{\ref{ex:ultracompact}.}
Construct $\bm{X}$ and distance-preserving embeddings $\spc{X}_n\hookrightarrow\bm{X}$ that satisfy \ref{propery:GH}.
Given $x_\infty\in \spc{X}_\infty$, choose a sequence $x_n\in \spc{X}_n$ such that $x_n\to x_\infty$ in $\bm{X}$.
Let $x_\omega$ be the $\omega$-limit of the sequence $x_n$ in $\bm{X}$.
Note that $x_\omega\in \spc{X}_\infty$.
Show that the map $x_\infty\mapsto x_\omega$ is defined; that is, it does not depend on the choice of the sequence $x_n$.
Further, show that the map $x_\infty\mapsto x_\omega$ is an isometry of $\spc{X}_\infty$.
Make a conclusion.

\parbf{\ref{ex:ultrapower}.}
Further, we consider $\spc{X}$ as a subset of $\spc{X}^\omega$.

\parit{\ref{SHORT.ex:ultrapower:a}.} Follows directly from the definitions.

\parit{\ref{SHORT.ex:ultrapower:compact}.}
Suppose $\spc{X}$ compact.
Given a sequence $x_1,x_2,\dots{}\in\spc{X}$, denote its $\omega$-limit in $\spc{X}^\omega$ by $x^\omega$ and its $\omega$-limit in $\spc{X}$ by $x_\omega$.

Observe that $x^\omega=\iota(x_\omega)$.
Therefore, $\iota$ is onto.

If $\spc{X}$ is not compact, we can choose a sequence $x_n$ such that $\dist{x_m}{x_n}{}>\eps$ for fixed $\eps>0$ and all $m\ne n$.
Observe that
\[\lim_{n\to\omega}\dist{x_n}{y}{\spc{X}}\ge \tfrac\eps2\]
for any $y\in\spc{X}$.
It follows that $x_\omega$ lies at the distance $\ge\tfrac\eps2$ from~$\spc{X}$.

\parit{\ref{SHORT.ex:ultrapower:proper}.}
A sequence of points $x_n$ in $\spc{X}$ will be called $\omega$-bounded if there is a real constant $C$ such that
\[\dist{p}{x_n}{\spc{X}}\le C\] 
for $\omega$-almost all $n$.

The same argument as in \ref{SHORT.ex:ultrapower:compact} shows that any $\omega$-bounded sequence has its $\omega$-limit in $\spc{X}$.
Further, if $(x_n)$ is not  $\omega$-bounded, then 
\[\lim_{n\to\omega}\dist{p}{x_n}{\spc{X}}=\infty;\]
that is, $x_\omega$ does not lie in the metric component of $p$ in $\spc{X}^\omega$.

\parbf{\ref{ex:isom-ultrapower}.}
Let us show that cardinality of $\spc{X}^\omega$ is at least continuum ---
it is sufficient to construct a continuum family $\mathcal{A}$ sequences of points on $\spc{X}$ such that for any two sequences $(a_n)$ and $(b_n)$ in $\mathcal{A}$ the equality $a_n=b_n$ holds only for finitely many $n$.

To do this, let us identify points in $\spc{X}$ with nonnegative integers.
Consider the set $\mathcal{A}$ of all sequences $a_n$ such that $a_0=0$ and $a_{n+1}\z=a_n+\eps_n\cdot 2^n$ where $\eps_n\in\{0,1\}$ for any $n$.
Observe that $\mathcal{A}$ has cardinality continuum and distinct sequences in $\mathcal{A}$ have distinct $\omega$-limits.

Show and use that the spaces $\spc{X}^\omega$ and $(\spc{X}^\omega)^\omega$ have discrete metrics and both have cardinality at most continuum.

\parit{A more conceptual construction of $\mathcal{A}$.}
Choose a compact metric space $\spc{K}$ with continuum points, say $\spc{K}=[0,1]$.
Identify $\spc{X}$ with a dense subset of $\spc{K}$.
For any point $k\in \spc{K}$, choose a sequence $a_n\in \spc{X}$ that converges to $k$.
Observe that the family of all these sequences meet the required condition.


\parbf{\ref{ex:ultrapower(ultrapower)}.}
Choose a bijection $\iota\:\NN\to \NN\times \NN$.
Given a set $S\subset \NN$, consider the sequence $S_1$, $S_2,\dots$ of subsets in $\NN$ defined by $m\in S_n$ if $(m,n)\z=\iota(k)$ for some $k\in S$.
Set $\omega_1(S)=1$ if and only if $\omega(S_n)=1$ for $\omega$-almost all $n$.
It remains to check that $\omega_1$ meets the conditions of the exercise.

\parit{Comment.}
It turns out that $\omega_1\ne \omega$ for any $\iota$;
see the post of Andreas Blass \cite{blass}.

\parbf{\ref{ex:two-geodesics-in-ultrapower}.}
Arguing as in \ref{obs:ultrapower-is-geodesic}, we get a pair of points $x$ and $y$ in $\spc{X}$ such that
\[\dist{p}{x}{}+\dist{x}{y}{}+\dist{y}{q}{}=\dist{p}{q}{}\]
and there is no midpoint between $x$ and $y$ in $\spc{X}$
(possibly $p=x$ and $q=y$).
Note that it is sufficient to show that there is a continuum of distinct midpoints in $\spc{X}^\omega$ between $x$ and $y$ in $\spc{X}$.

Since $\spc{X}$ is a length space, we can choose a $\tfrac1n$-midpoint $m_n\in\spc{X}$ between $x$ and $y$.
Note that the sequence $m_n$ contains no converging subsequence.
Conclude that we may pass to a subsequence of $m_n$ such that $\dist{m_i}{m_j}{}>\eps$ for a fixed $\eps>0$ and any $i\ne j$.

Argue as in \ref{ex:isom-ultrapower} to show that there is a continuum of distinct $\omega$-limits of subsequences of $m_n$;
each such limit is a midpoint between $x$ and $y$.

\parbf{\ref{ex:notproper-limit}.} Consider the infinite metric $\spc{T}$ tree with unit edges shown
on the diagram.
Observe that $\spc{T}$ is proper.

\begin{Figure}
\vskip-0mm
\centering
\includegraphics{mppics/pic-605}
\end{Figure}

Consider the vertex $v_\omega=\lim_{n\to\omega}v_n$ in the ultrapower $\spc{T}^\omega$.
Observe that $\omega$ has an infinite degree.
Conclude that $\spc{T}^\omega$ is not locally compact.

\parbf{\ref{ex:ultraT}.}
Consider a product of an infinite sequence of two-point spaces.

\parit{Remark.}
There are such examples of geodesic spaces with a cocompact isometric action of a finitely generated group \cite{thomas-velickovic}.

\parbf{\ref{ex:Asym(Lob)}.} Assume $\spc{L}$ is the Lobachevsky plane.

\parit{\ref{SHORT.ex:Asym(Lob):metric-tree}.}
Show that there is $\delta>0$ such that sides of any geodesic triangle in $\spc{L}$ intersect a disk of radius $\delta$.
Conclude that any geodesic triangle in $\Asym\spc{L}$ is a tripod.

\parit{\ref{SHORT.ex:Asym(Lob):homogeneous}.} Observe that $\spc{L}$ is one-point-homogeneous and use it.

\parit{\ref{SHORT.ex:Asym(Lob):continuum}.} 
By \ref{SHORT.ex:Asym(Lob):homogeneous}, it is sufficient to show that $p_\omega$ has a continuum degree.

Choose distinct geodesics $\gamma_1,\gamma_2\:[0,\infty)\z\to L$ that start at a point $p$.
Show that the limits of $\gamma_1$ and $\gamma_2$ run in the different connected components of $(\Asym\spc{L})\setminus \{p_\omega\}$.
Since there is a continuum of distinct geodesics starting at $p$,
we get that the degree of $p_\omega$ is at least continuum.

On the other hand, the set of sequences of points in $\spc{L}$  has cardinality continuum.
In particular, the set of points in $\Asym\spc{L}$ has cardinality at most continuum.
It follows that the degree of any vertex is at most continuum.

The proof for the Lobachevsky space goes along the same lines.

For the infinite three-regular tree, part \ref{SHORT.ex:Asym(Lob):metric-tree} follows from \ref{ex:lim(tree)}.
The three-regular tree is only vertex-homogeneous; the latter is sufficient to prove \ref{SHORT.ex:Asym(Lob):homogeneous}.
No changes are needed in~\ref{SHORT.ex:Asym(Lob):continuum}.

\parit{Remark.}
The properties \ref{SHORT.ex:Asym(Lob):homogeneous} and \ref{SHORT.ex:Asym(Lob):continuum} describe the tree $\spc{T}$ up to isometry \cite{dyubina-polterovich}.
In particular, the asymptotic space of the Lobachevsky plane does not depend on the choice of the ultrafilter and the sequence $\lambda_n\z\to \infty$.


\parbf{\ref{ex:T(Sx[0,1]/Sx0)}.}
Denote by $o_\omega$ the point in $\T^\omega_o\spc{X}$ that corresponds to $o$.
Argue as in \ref{ex:Asym(Lob):continuum} to show that $\T^\omega_o\spc{X}\setminus \{o_\omega\}$ has a continuum of connected components.
Further, show that each connected component $\spc{W}_\alpha$ is isometric to $\RR\times (0,\infty)$ with the metric described by
\begin{align*}
&\dist{(x_1,t_1)}{(x_2,t_2)}{}=
\\
&\qquad=\min\{\,\dist{(x_1,t_1)}{(x_2,t_2)}{\RR^2},t_1+t_2\,\}.
\end{align*}

Conclude that the space $\T^\omega_o\spc{X}$ can be described as follows.
Prepare continuum copies $\spc{W}_\alpha$ as above;
denote by $(x,t)_\alpha$ the point in $\spc{W}_\alpha$ with coordinates $(x,t)$.
The tangent space is the disjoint union of single point $o_\omega$ and all $\spc{W}_\alpha$ with metric
such that $\dist{(x_1,t_1)_\alpha}{(x_2,t_2)_\alpha}{}$ is the same as in $\spc{W}_\alpha$ and for the remaining pairs, we have $\dist{o_\omega}{(x,t)_\alpha}{}=t$ and $\dist{(x_1,t_1)_\alpha}{(x_2,t_2)_\beta}{}=t_1+t_2$
if $\alpha\ne\beta$.
